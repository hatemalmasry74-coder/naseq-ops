<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ููุตุฉ ููุณูู โ ุงูุฒูุงุฑุงุช</title>

  <link rel="stylesheet" href="nasaq-theme.css">
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    .mini{font-size:12px}
    .row .input{flex:1;min-width:180px}
    @media print{
      .topbar,.nav,.no-print{display:none!important}
      body{background:#fff!important;color:#000!important}
    }
    .upload-box{
      display:block;
      padding:18px;
      border:2px dashed var(--primary);
      border-radius:12px;
      text-align:center;
      cursor:pointer;
      background:#fff;
    }
    .file-name{
      margin-top:8px;
      font-size:14px;
      color:#666;
    }
  </style>
</head>

<body>

<div class="topbar">
  <div class="brand">
    <div class="logo">ู</div>
    <div>
      <div style="font-weight:900;font-size:18px">ุบุฑูุฉ ุนูููุงุช ููุณูู</div>
      <div class="muted">Pilot: ุทูุจู โข ุณุฏู โข ุฏุจู ุจู โ (ุนุฑุจู/RTL)</div>
    </div>
  </div>
  <div class="badge">MVP ูุญูู</div>
</div>

<div class="container">
  <div class="nav">
    <a data-nav href="index.html">ููุญุฉ ุงูุชุญูู</a>
    <a data-nav href="visits.html">ุงูุฒูุงุฑุงุช</a>
    <a data-nav href="issues.html">CAPA &amp; ุงูููุงุญุธุงุช</a>
    <a data-nav href="tasks.html">ุงูููุงู</a>
    <a data-nav href="cleaning.html">ุงููุธุงูุฉ ุงูููููุฉ</a>
    <a data-nav href="sop.html">ููุชุจุฉ SOP</a>
    <a data-nav href="settings.html">ุงูุฅุนุฏุงุฏุงุช</a>
  </div>

  <!-- ุฑูุน ุชูุฑูุฑ ุฒูุงุฑุฉ -->
  <div class="card" style="grid-column:span 12;margin-bottom:14px">
    <h3 style="margin:0 0 8px;color:var(--primary)">
      ๐ ุฅุฑูุงู ุชูุฑูุฑ ุฒูุงุฑุฉ (PDF / Word)
    </h3>
    <div class="muted mini" style="margin-bottom:10px">
      ุฑูุน ููู ุงูุชูุฑูุฑ ููุฒูุงุฑุฉ ุงูุญุงููุฉ (ุนุฑุถ ุงูุงุณู ููุท โ ุงูุญูุธ ุงููุนูู ูุฑุญูุฉ ูุงุญูุฉ)
    </div>

    <label class="upload-box">
      <input type="file" id="visitFile" accept=".pdf,.doc,.docx" hidden>
      <span>ุงุถุบุท ูุงุฎุชูุงุฑ ุงูููู</span>
    </label>

    <div id="fileName" class="file-name">ูู ูุชู ุงุฎุชูุงุฑ ููู</div>
  </div>

  <div class="grid">
    <!-- CREATE VISIT -->
    <div class="card" style="grid-column:span 5">
      <h3>ุฅูุดุงุก ุฒูุงุฑุฉ</h3>
      <div class="muted mini">
        ุฃู ุฒูุงุฑุฉ ุบูุฑ ูุทุงุจูุฉ ูุชู ุชุญููููุง ุชููุงุฆููุง ุฅูู CAPA.
      </div>

      <label class="small">ุงูุจุฑุงูุฏ</label>
      <select id="vBrand" class="input"></select>

      <label class="small">ุงููุฑุน</label>
      <select id="vBranch" class="input"></select>

      <label class="small">ููุน ุงูุฒูุงุฑุฉ</label>
      <select id="vType" class="input">
        <option>ุชุดุบูููุฉ</option>
        <option>ูุงููุฉ</option>
        <option>ูุธุงูุฉ</option>
        <option>ุฅุฏุงุฑูุฉ</option>
      </select>

      <label class="small">ุงูุชูููู</label>
      <select id="vResult" class="input">
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
      </select>

      <label class="small">ููุงุญุธุงุช ุงูุฒูุงุฑุฉ</label>
      <textarea id="vNotes" class="input" style="min-height:90px"
        placeholder="ุงูุชุจ ููุฎุต ุงูุฒูุงุฑุฉ..."></textarea>

      <div class="row" style="margin-top:12px">
        <button class="btn primary" id="addVisit">ุญูุธ ุงูุฒูุงุฑุฉ</button>
        <button class="btn ghost" id="resetVisit" type="button">ุชูุฑูุบ</button>
      </div>
    </div>

    <!-- VISITS TABLE -->
    <div class="card" style="grid-column:span 7">
      <h3>ุณุฌู ุงูุฒูุงุฑุงุช</h3>

      <div class="row no-print" style="margin:10px 0">
        <select id="fType" class="input" style="max-width:220px">
          <option value="">ูู ุงูุฃููุงุน</option>
          <option>ุชุดุบูููุฉ</option>
          <option>ูุงููุฉ</option>
          <option>ูุธุงูุฉ</option>
          <option>ุฅุฏุงุฑูุฉ</option>
        </select>

        <select id="fResult" class="input" style="max-width:220px">
          <option value="">ูู ุงููุชุงุฆุฌ</option>
          <option>ูุทุงุจู</option>
          <option>ุบูุฑ ูุทุงุจู</option>
        </select>

        <input id="fSearch" class="input" placeholder="ุจุญุซ">
        <button class="btn" onclick="window.print()">PDF</button>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>ุงูุชุงุฑูุฎ</th>
            <th>ุงูุจุฑุงูุฏ</th>
            <th>ุงููุฑุน</th>
            <th>ุงูููุน</th>
            <th>ุงููุชูุฌุฉ</th>
            <th>CAPA</th>
            <th>ููุงุญุธุงุช</th>
          </tr>
        </thead>
        <tbody id="visitTbody"></tbody>
      </table>
    </div>
  </div>

  <div class="footer">
    ูููุฐุฌ ุฃููู โ ููุตุฉ ููุณูู.
  </div>
</div>

<script>
/* ===== Helpers ===== */
const $ = id => document.getElementById(id);
const DB_KEY = "naseq_ops_db_v1";
const nowISO = () => new Date().toISOString();

/* ===== File Upload UI ===== */
$("visitFile").addEventListener("change", function(){
  const f = this.files[0];
  $("fileName").innerText = f ? ("๐ " + f.name) : "ูู ูุชู ุงุฎุชูุงุฑ ููู";
});

/* ===== Local DB ===== */
function load(){
  return JSON.parse(localStorage.getItem(DB_KEY)) || seed();
}
function save(db){
  localStorage.setItem(DB_KEY, JSON.stringify(db));
}
function seed(){
  const db={
    brands:[
      {id:"tuba",name:"ุทูุจู",branches:[{id:"main",name:"ุงููุฑุน ุงูุฑุฆูุณู"}]},
      {id:"sdf",name:"ุณุฏู",branches:[{id:"main",name:"ุงููุฑุน ุงูุฑุฆูุณู"}]},
      {id:"dbb",name:"ุฏุจู ุจู",branches:[{id:"main",name:"ุงููุฑุน ุงูุฑุฆูุณู"}]}
    ],
    visits:[],
    issues:[]
  };
  save(db); return db;
}

/* ===== Init ===== */
function initSelectors(){
  const db = load();
  $("vBrand").innerHTML = db.brands.map(b=>`<option value="${b.id}">${b.name}</option>`).join("");
  $("vBrand").onchange = ()=>{
    const b = db.brands.find(x=>x.id===$("vBrand").value);
    $("vBranch").innerHTML = b.branches.map(br=>`<option value="${br.id}">${br.name}</option>`).join("");
  };
  $("vBrand").dispatchEvent(new Event("change"));
}

/* ===== Render Visits ===== */
function renderVisits(){
  const db = load();
  $("visitTbody").innerHTML = db.visits.reverse().map(v=>`
    <tr>
      <td>${new Date(v.createdAt).toLocaleString("ar-SA")}</td>
      <td>${v.brandName}</td>
      <td>${v.branchName}</td>
      <td>${v.type}</td>
      <td>${v.result}</td>
      <td>${v.capaId || "โ"}</td>
      <td>${v.notes || "โ"}</td>
    </tr>
  `).join("") || `<tr><td colspan="7" class="muted">ูุง ุชูุฌุฏ ุฒูุงุฑุงุช</td></tr>`;
}

/* ===== Add Visit ===== */
$("addVisit").onclick = ()=>{
  const db = load();
  db.visits.push({
    brandId:$("vBrand").value,
    brandName:$("vBrand").selectedOptions[0].text,
    branchId:$("vBranch").value,
    branchName:$("vBranch").selectedOptions[0].text,
    type:$("vType").value,
    result:$("vResult").value,
    notes:$("vNotes").value,
    createdAt:nowISO(),
    capaId: $("vResult").value==="ุบูุฑ ูุทุงุจู" ? "CAPA-"+Math.random().toString(16).slice(2,6) : null
  });
  save(db);
  alert("ุชู ุญูุธ ุงูุฒูุงุฑุฉ");
  $("vNotes").value="";
  renderVisits();
};

initSelectors();
renderVisits();
</script>

</body>
</html>
