<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ù…Ù†ØµØ© Ù†ÙØ³ÙÙ‚ â€“ Ø§Ù„ØªÙ‚ÙÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>

  <!-- Ø«ÙŠÙ… Ù†Ø³Ù‚ -->
  <link rel="stylesheet" href="nasaq-theme.css">
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --card:#ffffff; --txt:#111; --muted:#6b7280; --border:#e5e7eb;
      --danger:#b91c1c; --ok:#065f46;
    }
    body{font-family:"Almarai",system-ui,-apple-system,Segoe UI,Roboto,Arial; background: var(--bg,#0b0b0c); color:var(--text,#f3f4f6);}
    .wrap{max-width:1100px; margin:18px auto; padding:14px;}
    .topbar{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:12px}
    .brand{display:flex; align-items:center; gap:10px}
    .logo{width:44px; height:44px; border-radius:14px; background: linear-gradient(135deg, var(--primary,#b91c1c), #f59e0b); box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0; font-size:20px; font-weight:900}
    .sub{color:var(--muted,#a3a3a3); font-size:12px}

    .grid{display:grid; gap:12px}
    @media(min-width:980px){ .grid{grid-template-columns: 1.2fr .8fr} }

    .card{background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10); border-radius:18px; padding:14px; box-shadow:0 14px 35px rgba(0,0,0,.25)}
    .card h2{margin:0 0 10px; font-size:15px; font-weight:900}
    .row{display:grid; gap:10px}
    @media(min-width:720px){ .row.two{grid-template-columns:1fr 1fr} .row.three{grid-template-columns:1fr 1fr 1fr} }

    label{display:block; font-size:12px; color:rgba(255,255,255,.85); margin:0 0 6px}
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: #fff;
      outline:none;
    }
    input::placeholder, textarea::placeholder{color:rgba(255,255,255,.45)}
    textarea{min-height:90px; resize:vertical}
    .hint{font-size:11px; color:rgba(255,255,255,.65); margin-top:6px}
    .req{color:#ffb4b4; font-weight:900; margin-inline-start:6px}

    .kpis{display:grid; gap:10px}
    @media(min-width:720px){ .kpis{grid-template-columns:1fr 1fr 1fr} }
    .kpi{
      border:1px dashed rgba(255,255,255,.18);
      border-radius:16px; padding:12px;
      background: rgba(255,255,255,.04);
    }
    .kpi .t{font-size:12px; color:rgba(255,255,255,.75)}
    .kpi .v{font-size:22px; font-weight:900; margin-top:6px}
    .kpi.ok{border-color:rgba(34,197,94,.35)}
    .kpi.bad{border-color:rgba(239,68,68,.45)}
    .kpi .small{font-size:11px; color:rgba(255,255,255,.6); margin-top:4px}

    .btns{display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-end}
    button{
      border:0; cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      color:#fff;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      font-weight:800;
    }
    button.primary{background: linear-gradient(135deg, var(--primary,#b91c1c), #f59e0b); border:0}
    button.danger{background: rgba(239,68,68,.18); border:1px solid rgba(239,68,68,.35)}
    button.ok{background: rgba(34,197,94,.18); border:1px solid rgba(34,197,94,.35)}
    button:disabled{opacity:.5; cursor:not-allowed}

    .table{width:100%; border-collapse:separate; border-spacing:0 8px}
    .table th{font-size:12px; text-align:right; color:rgba(255,255,255,.75); padding:0 8px}
    .table td{padding:6px 8px}
    .table .tr{
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
    }
    .table .tr td:first-child{border-top-right-radius:14px;border-bottom-right-radius:14px}
    .table .tr td:last-child{border-top-left-radius:14px;border-bottom-left-radius:14px}
    .mini{width:100%}
    .mini input{padding:8px;border-radius:12px}

    .uploads{display:grid; gap:10px}
    .uploadBox{border:1px dashed rgba(255,255,255,.18); border-radius:16px; padding:12px; background: rgba(0,0,0,.14)}
    .uploadHead{display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .tag{font-size:11px; padding:4px 8px; border-radius:999px; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12)}
    .thumbs{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .thumbs img{width:110px; height:110px; object-fit:cover; border-radius:12px; border:1px solid rgba(255,255,255,.14)}

    .status{font-size:12px; padding:8px 10px; border-radius:14px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.18)}
    .status.ok{border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.12)}
    .status.bad{border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.10)}
    .status.neu{border-color: rgba(255,255,255,.14); background: rgba(255,255,255,.06)}

    .printOnly{display:none}
    @media print{
      body{background:#fff;color:#111}
      .wrap{max-width:100%; margin:0; padding:0}
      .card{background:#fff; color:#111; border:1px solid #e5e7eb; box-shadow:none}
      input,select,textarea{color:#111; background:#fff; border:1px solid #e5e7eb}
      .topbar,.btns,.hint{display:none!important}
      .printOnly{display:block}
      .thumbs img{border:1px solid #e5e7eb}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚ÙÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>
          <div class="sub">Ù†Ø³Ø®Ø© Ø±Ù‚Ù…ÙŠØ© Ù„Ù„ØªÙˆØ«ÙŠÙ‚ + Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª + Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</div>
        </div>
      </div>

      <div class="btns">
        <button id="btnLoad" title="Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø­ÙØ¸">Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø­ÙØ¸</button>
        <button id="btnDraft" class="primary">Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø©</button>
        <button id="btnApprove" class="ok">Ø§Ø¹ØªÙ…Ø§Ø¯</button>
        <button id="btnExport">ØªØµØ¯ÙŠØ± JSON</button>
        <button id="btnPrint">Ø·Ø¨Ø§Ø¹Ø©</button>
        <button id="btnClear" class="danger">Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
      </div>
    </div>

    <div class="grid">

      <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø± -->
      <div class="card">
        <h2>1) Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
        <div class="row three">
          <div>
            <label>Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ <span class="req">*</span></label>
            <select id="brand" required>
              <option value="">Ø§Ø®ØªØ±</option>
              <option>Ø³Ø¯Ù</option>
              <option>Ø·ÙˆØ¨Ù‰</option>
              <option>Ø¯Ø¨Ù„ Ø¨ÙŠ</option>
              <option>Ø´Ø§ÙŠÙ†</option>
              <option>Ø£Ø®Ø±Ù‰</option>
            </select>
          </div>
          <div>
            <label>Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹ <span class="req">*</span></label>
            <input id="branch" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨Ù‡Ø§ â€“ Ø§Ù„Ù…Ø­Ø§Ù„Ø©" required>
          </div>
          <div>
            <label>Ø§Ù„ØªØ§Ø±ÙŠØ® <span class="req">*</span></label>
            <input id="date" type="date" required>
          </div>
        </div>

        <div class="row three" style="margin-top:10px">
          <div>
            <label>Ø§Ù„ÙˆØ±Ø¯ÙŠØ© <span class="req">*</span></label>
            <select id="shift" required>
              <option value="">Ø§Ø®ØªØ±</option>
              <option value="ØµØ¨Ø§Ø­ÙŠ">ØµØ¨Ø§Ø­ÙŠ</option>
              <option value="Ù…Ø³Ø§Ø¦ÙŠ">Ù…Ø³Ø§Ø¦ÙŠ</option>
              <option value="ÙŠÙˆÙ…ÙŠ">ÙŠÙˆÙ…ÙŠ (ÙƒØ§Ù…Ù„)</option>
            </select>
          </div>
          <div>
            <label>Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ± <span class="req">*</span></label>
            <input id="cashier" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±" required>
          </div>
          <div>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù/Ø§Ù„Ù…Ø¯ÙŠØ± <span class="req">*</span></label>
            <input id="supervisor" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù" required>
          </div>
        </div>

        <div class="row three" style="margin-top:10px">
          <div>
            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="orders" type="number" min="0" step="1" placeholder="0">
          </div>
          <div>
            <label>Ø±Ù‚Ù… Ø¬Ù‡Ø§Ø² Ø§Ù„Ø´Ø¨ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="spanDevice" placeholder="Ù…Ø«Ø§Ù„: SP-01 / Ø¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù…">
          </div>
          <div>
            <label>Ø±ØµÙŠØ¯ Ø§ÙØªØªØ§Ø­ÙŠØ© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ (Float) <span class="req">*</span></label>
            <input id="openingFloat" type="number" min="0" step="0.01" placeholder="0.00" required>
            <div class="hint">Ù…Ù‡Ù… Ù„ØªÙØ§Ø¯ÙŠ Ø¹Ø¬Ø²/Ø²ÙŠØ§Ø¯Ø© ÙˆÙ‡Ù…ÙŠØ©</div>
          </div>
        </div>

        <hr style="border:0;border-top:1px solid rgba(255,255,255,.10);margin:14px 0">

        <h2>2) Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (POS vs ÙØ¹Ù„ÙŠ)</h2>
        <div class="row three">
          <div>
            <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… (POS) <span class="req">*</span></label>
            <input id="posTotal" type="number" step="0.01" min="0" placeholder="0.00" required>
          </div>
          <div>
            <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… (POS) <span class="req">*</span></label>
            <input id="posCard" type="number" step="0.01" min="0" placeholder="0.00" required>
          </div>
          <div>
            <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ§Ø´ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… (POS) <span class="req">*</span></label>
            <input id="posCash" type="number" step="0.01" min="0" placeholder="0.00" required>
          </div>
        </div>

        <div class="row three" style="margin-top:10px">
          <div>
            <label>Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© (Ø­Ø³Ø¨ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø´Ø¨ÙƒØ©) <span class="req">*</span></label>
            <input id="actualCard" type="number" step="0.01" min="0" placeholder="0.00" required>
          </div>
          <div>
            <label>Ø§Ù„ÙƒØ§Ø´ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø±Ø¬ <span class="req">*</span></label>
            <input id="actualCashInDrawer" type="number" step="0.01" min="0" placeholder="0.00" required>
          </div>
          <div>
            <label>Ù…ØµØ±ÙˆÙØ§Øª Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ (Ø¥Ù† ÙˆØ¬Ø¯Øª)</label>
            <input id="cashExpenses" type="number" step="0.01" min="0" placeholder="0.00">
            <div class="hint">Ù…Ø«Ø§Ù„: Ù…Ø´ØªØ±ÙŠØ§Øª Ø·Ø§Ø±Ø¦Ø©/Ù…ÙŠØ§Ù‡â€¦ (Ø£Ø±ÙÙ‚ ØµÙˆØ±Ù‡Ø§ Ø¥Ù† Ù„Ø²Ù…)</div>
          </div>
        </div>

        <div class="kpis" style="margin-top:12px">
          <div class="kpi" id="kpiDiffCard">
            <div class="t">ÙØ±Ù‚ Ø§Ù„Ø´Ø¨ÙƒØ© (POS - Ø¬Ù‡Ø§Ø²)</div>
            <div class="v" id="diffCard">0.00</div>
            <div class="small" id="diffCardNote">â€”</div>
          </div>
          <div class="kpi" id="kpiDiffCash">
            <div class="t">ÙØ±Ù‚ Ø§Ù„ÙƒØ§Ø´ (POS - ÙØ¹Ù„ÙŠ)</div>
            <div class="v" id="diffCash">0.00</div>
            <div class="small" id="diffCashNote">â€”</div>
          </div>
          <div class="kpi" id="kpiDeposit">
            <div class="t">ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
            <div class="v" id="expectedDeposit">0.00</div>
            <div class="small">= (Ø§Ù„ÙƒØ§Ø´ Ø§Ù„ÙØ¹Ù„ÙŠ - Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ© - Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª)</div>
          </div>
        </div>

        <div class="row two" style="margin-top:12px">
          <div>
            <label>ØµØ§ÙÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„ÙØ¹Ù„ÙŠ (Deposit) <span class="req">*</span></label>
            <input id="actualDeposit" type="number" step="0.01" min="0" placeholder="0.00" required>
            <div class="hint">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥ÙŠØ¯Ø§Ø¹Ù‡/ØªØ¬Ù‡ÙŠØ²Ù‡ Ù„Ù„Ø¥ÙŠØ¯Ø§Ø¹</div>
          </div>
          <div>
            <label>ÙØ±Ù‚ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ (Ù…ØªÙˆÙ‚Ø¹ - ÙØ¹Ù„ÙŠ)</label>
            <input id="depositDiff" type="text" readonly>
            <div class="hint">Ø¥Ù† Ø¸Ù‡Ø± ÙØ±Ù‚ â†’ ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨</div>
          </div>
        </div>

        <div class="row two" style="margin-top:10px">
          <div>
            <label>Ø³Ø¨Ø¨ Ø§Ù„ÙØ§Ø±Ù‚ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ÙØ±Ù‚)</label>
            <input id="diffReason" placeholder="Ù…Ø«Ø§Ù„: Ø®Ø·Ø£ Ø¥Ø¯Ø®Ø§Ù„/Ø³Ù„ÙØ©/Ù†Ù‚Øµ ÙƒØ§Ø´/ÙØ±Ù‚ Ø´Ø¨ÙƒØ©â€¦">
          </div>
          <div>
            <label>ØªØµÙ†ÙŠÙ Ø§Ù„ÙØ§Ø±Ù‚</label>
            <select id="diffType">
              <option value="">â€”</option>
              <option value="Ø¹Ø¬Ø²">Ø¹Ø¬Ø²</option>
              <option value="Ø²ÙŠØ§Ø¯Ø©">Ø²ÙŠØ§Ø¯Ø©</option>
              <option value="Ù…Ù„Ø§Ø­Ø¸Ø©">Ù…Ù„Ø§Ø­Ø¸Ø©</option>
            </select>
          </div>
        </div>

        <hr style="border:0;border-top:1px solid rgba(255,255,255,.10);margin:14px 0">

        <h2>3) ØªÙØµÙŠÙ„ Ø§Ù„Ø´Ø¨ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„ØªØ¯Ù‚ÙŠÙ‚)</h2>
        <div class="row three">
          <div>
            <label>Ù…Ø¯Ù‰ (Mada)</label>
            <input id="mada" type="number" step="0.01" min="0" placeholder="0.00">
          </div>
          <div>
            <label>Visa</label>
            <input id="visa" type="number" step="0.01" min="0" placeholder="0.00">
          </div>
          <div>
            <label>MasterCard</label>
            <input id="master" type="number" step="0.01" min="0" placeholder="0.00">
          </div>
        </div>
        <div class="row two" style="margin-top:10px">
          <div>
            <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙØµÙŠÙ„ Ø§Ù„Ø´Ø¨ÙƒØ© (Ù…Ø­Ø³ÙˆØ¨)</label>
            <input id="cardsBreakdownTotal" type="text" readonly>
          </div>
          <div>
            <label>Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø´Ø¨ÙƒØ©</label>
            <input id="cardNote" placeholder="Ù…Ø«Ø§Ù„: Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù‡Ø§Ø² ØªÙ… Ø¥Ø±ÙØ§Ù‚Ù‡Ø§">
          </div>
        </div>

        <hr style="border:0;border-top:1px solid rgba(255,255,255,.10);margin:14px 0">

        <h2>4) VOID / Ù…Ø±ØªØ¬Ø¹Ø§Øª (Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯Ù‡Ø§)</h2>
        <table class="table">
          <thead>
            <tr>
              <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø§Ù„Ø³Ø¨Ø¨</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="voidBody"></tbody>
        </table>
        <div class="btns" style="justify-content:flex-start">
          <button id="btnAddVoid">+ Ø¥Ø¶Ø§ÙØ© VOID</button>
        </div>

        <hr style="border:0;border-top:1px solid rgba(255,255,255,.10);margin:14px 0">

        <h2>5) Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>
        <div class="row two">
          <div>
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙƒØ§Ø´ÙŠØ±</label>
            <textarea id="cashierNotes" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªØ®Øµ Ø§Ù„ØªÙ‚ÙÙŠÙ„..."></textarea>
          </div>
          <div>
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù</label>
            <textarea id="supervisorNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©/Ø§Ù„ØªÙˆØ¬ÙŠÙ‡..."></textarea>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù† -->
      <div class="card">
        <h2>6) Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (ØµÙˆØ± Ø¥Ù„Ø²Ø§Ù…ÙŠØ©)</h2>
        <div class="uploads">
          <div class="uploadBox">
            <div class="uploadHead">
              <div>
                <b>ØµÙˆØ±Ø© ÙˆØ±Ù‚Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</b> <span class="req">*</span>
                <div class="hint">ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© ØªØ´Ù…Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…</div>
              </div>
              <span class="tag" id="tagClose">ØºÙŠØ± Ù…Ø±ÙÙˆØ¹Ø©</span>
            </div>
            <input id="imgClose" type="file" accept="image/*" multiple>
            <div class="thumbs" id="thumbClose"></div>
          </div>

          <div class="uploadBox">
            <div class="uploadHead">
              <div>
                <b>ØµÙˆØ±Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ©/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¬Ù‡Ø§Ø²</b> <span class="req">*</span>
                <div class="hint">Ø¥Ù† ÙƒØ§Ù† Ù…ØªØ§Ø­Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</div>
              </div>
              <span class="tag" id="tagSpan">ØºÙŠØ± Ù…Ø±ÙÙˆØ¹Ø©</span>
            </div>
            <input id="imgSpan" type="file" accept="image/*" multiple>
            <div class="thumbs" id="thumbSpan"></div>
          </div>

          <div class="uploadBox">
            <div class="uploadHead">
              <div>
                <b>Ø³Ù†Ø¯/Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø­Ø³Ø¨ ØªÙˆÙØ±Ù‡)</b>
                <div class="hint">ÙŠÙØ¶Ù‘Ù„ Ø¥Ø±ÙØ§Ù‚Ù‡ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯Ù‡</div>
              </div>
              <span class="tag" id="tagDep">ØºÙŠØ± Ù…Ø±ÙÙˆØ¹Ø©</span>
            </div>
            <input id="imgDep" type="file" accept="image/*" multiple>
            <div class="thumbs" id="thumbDep"></div>
          </div>
        </div>

        <hr style="border:0;border-top:1px solid rgba(255,255,255,.10);margin:14px 0">

        <h2>7) Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</h2>
        <div class="row">
          <div class="status neu" id="statusBox">Ø§Ù„Ø­Ø§Ù„Ø©: <b id="statusText">Ù…Ø³ÙˆØ¯Ø©</b></div>
          <div class="hint">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù‚Ø¨Ù„ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ© ÙˆØ±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.</div>
        </div>

        <div class="row two" style="margin-top:10px">
          <div>
            <label>Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„ÙƒØ§Ø´ÙŠØ± <span class="req">*</span></label>
            <select id="cashierAck" required>
              <option value="">Ø§Ø®ØªØ±</option>
              <option value="Ù†Ø¹Ù…">Ø£Ù‚Ø±Ù‘ Ø¨ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ø±ÙÙ‚Ø§Øª</option>
            </select>
          </div>
          <div>
            <label>Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø±Ù <span class="req">*</span></label>
            <select id="supervisorAck" required>
              <option value="">Ø§Ø®ØªØ±</option>
              <option value="Ù†Ø¹Ù…">Ø£Ù‚Ø±Ù‘ Ø¨Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯</option>
            </select>
          </div>
        </div>

        <div class="printOnly" style="margin-top:10px">
          <h3 style="margin:0 0 6px">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (Ù…ØµØºÙ‘Ø±Ø©)</h3>
          <div id="printThumbs"></div>
        </div>

        <div class="hint" style="margin-top:14px">
          ğŸ’¡ ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ (LocalStorage). Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø±Ø¨Ø·Ù‡ Ø¨ØªØ®Ø²ÙŠÙ† Ù…Ø±ÙƒØ²ÙŠ/Ø³ÙŠØ±ÙØ± Ø£Ùˆ Google Drive.
        </div>
      </div>

    </div>
  </div>

<script>
  // ===== Helpers =====
  const $ = (id)=>document.getElementById(id);
  const nf = (v)=> (isFinite(v) ? Number(v).toFixed(2) : "0.00");
  const num = (id)=> {
    const v = parseFloat($(id).value);
    return isFinite(v) ? v : 0;
  };
  const todayISO = ()=> {
    const d = new Date();
    const z = (n)=> String(n).padStart(2,"0");
    return d.getFullYear()+"-"+z(d.getMonth()+1)+"-"+z(d.getDate());
  };

  // ===== VOID Rows =====
  function makeVoidRow(data={}){
    const tr = document.createElement("tr");
    tr.className = "tr";
    tr.innerHTML = `
      <td><input class="mini v_inv" placeholder="ÙØ§ØªÙˆØ±Ø©" value="${data.invoice||""}"></td>
      <td><input class="mini v_phone" placeholder="Ø¬ÙˆØ§Ù„" value="${data.phone||""}"></td>
      <td><input class="mini v_amount" type="number" step="0.01" min="0" placeholder="0.00" value="${data.amount||""}"></td>
      <td><input class="mini v_reason" placeholder="Ø§Ù„Ø³Ø¨Ø¨" value="${data.reason||""}"></td>
      <td><button class="danger v_del" type="button">Ø­Ø°Ù</button></td>
    `;
    tr.querySelector(".v_del").onclick = ()=> tr.remove();
    return tr;
  }
  $("btnAddVoid").onclick = ()=> $("voidBody").appendChild(makeVoidRow());

  // ===== Image handling (Base64 previews) =====
  async function filesToBase64(fileList, maxPerFileMB=1.8){
    // NOTE: saving base64 in LocalStorage has size limits; we compress by limiting file size policy
    const out = [];
    for(const f of fileList){
      // soft warning if huge
      if(f.size > maxPerFileMB*1024*1024){
        alert("ØªÙ†Ø¨ÙŠÙ‡: Ø­Ø¬Ù… ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±. ÙŠÙÙØ¶Ù‘Ù„ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹ Ù„ØªÙØ§Ø¯ÙŠ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø­ÙØ¸.");
      }
      const b64 = await new Promise((res, rej)=>{
        const r = new FileReader();
        r.onload = ()=> res(r.result);
        r.onerror = rej;
        r.readAsDataURL(f);
      });
      out.push({name:f.name, type:f.type, size:f.size, data:b64});
    }
    return out;
  }

  function renderThumbs(list, holderId){
    const holder = $(holderId);
    holder.innerHTML = "";
    (list||[]).forEach(x=>{
      const img = document.createElement("img");
      img.src = x.data;
      img.alt = x.name || "image";
      holder.appendChild(img);
    });
  }

  function setTag(tagId, ok){
    const t = $(tagId);
    t.textContent = ok ? "ØªÙ… Ø§Ù„Ø±ÙØ¹" : "ØºÙŠØ± Ù…Ø±ÙÙˆØ¹Ø©";
    t.style.background = ok ? "rgba(34,197,94,.18)" : "rgba(255,255,255,.08)";
    t.style.borderColor = ok ? "rgba(34,197,94,.35)" : "rgba(255,255,255,.12)";
  }

  const imgs = {
    close: [],
    span: [],
    dep: []
  };

  $("imgClose").addEventListener("change", async (e)=>{
    imgs.close = await filesToBase64(e.target.files);
    renderThumbs(imgs.close, "thumbClose");
    setTag("tagClose", imgs.close.length>0);
    validate();
  });
  $("imgSpan").addEventListener("change", async (e)=>{
    imgs.span = await filesToBase64(e.target.files);
    renderThumbs(imgs.span, "thumbSpan");
    setTag("tagSpan", imgs.span.length>0);
    validate();
  });
  $("imgDep").addEventListener("change", async (e)=>{
    imgs.dep = await filesToBase64(e.target.files);
    renderThumbs(imgs.dep, "thumbDep");
    setTag("tagDep", imgs.dep.length>0);
    validate();
  });

  // ===== Calculations =====
  function recalc(){
    const posCard = num("posCard");
    const actualCard = num("actualCard");
    const posCash = num("posCash");
    const actualCash = num("actualCashInDrawer");
    const opening = num("openingFloat");
    const expenses = num("cashExpenses");
    const actualDeposit = num("actualDeposit");

    const diffCard = posCard - actualCard;
    const diffCash = posCash - actualCash;

    $("diffCard").textContent = nf(diffCard);
    $("diffCash").textContent = nf(diffCash);

    const expectedDeposit = Math.max(0, (actualCash - opening - expenses));
    $("expectedDeposit").textContent = nf(expectedDeposit);

    const depDiff = expectedDeposit - actualDeposit;
    $("depositDiff").value = nf(depDiff);

    // KPI styles
    const setKpi = (boxId, val)=>{
      const box = $(boxId);
      box.classList.remove("ok","bad");
      if(Math.abs(val) < 0.009) box.classList.add("ok");
      else box.classList.add("bad");
    };
    setKpi("kpiDiffCard", diffCard);
    setKpi("kpiDiffCash", diffCash);
    setKpi("kpiDeposit", depDiff);

    $("diffCardNote").textContent = Math.abs(diffCard) < 0.009 ? "Ù…Ø·Ø§Ø¨Ù‚" : "ÙŠÙˆØ¬Ø¯ ÙØ±Ù‚ ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©";
    $("diffCashNote").textContent = Math.abs(diffCash) < 0.009 ? "Ù…Ø·Ø§Ø¨Ù‚" : "ÙŠÙˆØ¬Ø¯ ÙØ±Ù‚ ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©";

    // Cards breakdown
    const cardsTotal = num("mada") + num("visa") + num("master");
    $("cardsBreakdownTotal").value = nf(cardsTotal);

    validate();
  }

  ["posCard","actualCard","posCash","actualCashInDrawer","openingFloat","cashExpenses","actualDeposit","mada","visa","master"]
    .forEach(id=> $(id).addEventListener("input", recalc));

  // ===== Validation =====
  function requiredFilled(){
    const reqIds = ["brand","branch","date","shift","cashier","supervisor","openingFloat","posTotal","posCard","posCash","actualCard","actualCashInDrawer","actualDeposit","cashierAck","supervisorAck"];
    for(const id of reqIds){
      const el = $(id);
      if(!el) continue;
      if((el.value||"").toString().trim()==="") return false;
    }
    return true;
  }

  function reasonRequired(){
    const depDiff = parseFloat($("depositDiff").value);
    const diffCard = parseFloat($("diffCard").textContent);
    const diffCash = parseFloat($("diffCash").textContent);
    const anyDiff = (Math.abs(depDiff) >= 0.01) || (Math.abs(diffCard) >= 0.01) || (Math.abs(diffCash) >= 0.01);
    if(anyDiff){
      return ($("diffReason").value||"").trim().length >= 4;
    }
    return true;
  }

  function imagesOk(){
    return imgs.close.length>0 && imgs.span.length>0; // dep optional
  }

  function validate(){
    const ok = requiredFilled() && imagesOk() && reasonRequired();
    $("btnApprove").disabled = !ok;

    const status = $("statusBox");
    status.classList.remove("ok","bad","neu");

    if(!requiredFilled()){
      status.classList.add("bad");
      $("statusText").textContent = "Ù…Ø³ÙˆØ¯Ø© (Ø­Ù‚ÙˆÙ„ Ù†Ø§Ù‚ØµØ©)";
      return;
    }
    if(!imagesOk()){
      status.classList.add("bad");
      $("statusText").textContent = "Ù…Ø³ÙˆØ¯Ø© (Ù…Ø±ÙÙ‚Ø§Øª Ù†Ø§Ù‚ØµØ©)";
      return;
    }
    if(!reasonRequired()){
      status.classList.add("bad");
      $("statusText").textContent = "Ù…Ø³ÙˆØ¯Ø© (Ø³Ø¨Ø¨ Ø§Ù„ÙØ§Ø±Ù‚ Ù…Ø·Ù„ÙˆØ¨)";
      return;
    }
    status.classList.add("ok");
    $("statusText").textContent = "Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯";
  }

  ["brand","branch","date","shift","cashier","supervisor","posTotal","posCard","posCash","actualCard","actualCashInDrawer","actualDeposit","cashierAck","supervisorAck","diffReason"]
    .forEach(id=> $(id).addEventListener("input", validate));

  // ===== Data pack/unpack =====
  function collectVoid(){
    const rows = Array.from($("voidBody").querySelectorAll("tr"));
    return rows.map(r=>({
      invoice: r.querySelector(".v_inv").value.trim(),
      phone: r.querySelector(".v_phone").value.trim(),
      amount: parseFloat(r.querySelector(".v_amount").value) || 0,
      reason: r.querySelector(".v_reason").value.trim()
    })).filter(x=> x.invoice || x.phone || x.amount || x.reason);
  }

  function pack(status="DRAFT"){
    return {
      meta: {
        app: "Nasaq Daily Closing",
        version: "1.0",
        status,
        savedAt: new Date().toISOString()
      },
      header: {
        brand: $("brand").value,
        branch: $("branch").value.trim(),
        date: $("date").value,
        shift: $("shift").value,
        cashier: $("cashier").value.trim(),
        supervisor: $("supervisor").value.trim(),
        orders: parseInt($("orders").value||"0",10) || 0,
        spanDevice: $("spanDevice").value.trim(),
        openingFloat: num("openingFloat")
      },
      sales: {
        posTotal: num("posTotal"),
        posCard: num("posCard"),
        posCash: num("posCash"),
        actualCard: num("actualCard"),
        actualCashInDrawer: num("actualCashInDrawer"),
        cashExpenses: num("cashExpenses"),
        expectedDeposit: parseFloat($("expectedDeposit").textContent) || 0,
        actualDeposit: num("actualDeposit"),
        diffCard: parseFloat($("diffCard").textContent) || 0,
        diffCash: parseFloat($("diffCash").textContent) || 0,
        depositDiff: parseFloat($("depositDiff").value) || 0,
        diffType: $("diffType").value,
        diffReason: $("diffReason").value.trim()
      },
      cardsBreakdown: {
        mada: num("mada"),
        visa: num("visa"),
        master: num("master"),
        total: parseFloat($("cardsBreakdownTotal").value) || 0,
        note: $("cardNote").value.trim()
      },
      voids: collectVoid(),
      notes: {
        cashier: $("cashierNotes").value.trim(),
        supervisor: $("supervisorNotes").value.trim()
      },
      approvals: {
        cashierAck: $("cashierAck").value,
        supervisorAck: $("supervisorAck").value
      },
      attachments: {
        closeSheetImages: imgs.close,
        spanReportImages: imgs.span,
        depositSlipImages: imgs.dep
      }
    };
  }

  function fill(data){
    if(!data) return;

    $("brand").value = data.header?.brand || "";
    $("branch").value = data.header?.branch || "";
    $("date").value = data.header?.date || todayISO();
    $("shift").value = data.header?.shift || "";
    $("cashier").value = data.header?.cashier || "";
    $("supervisor").value = data.header?.supervisor || "";
    $("orders").value = data.header?.orders ?? "";
    $("spanDevice").value = data.header?.spanDevice || "";
    $("openingFloat").value = data.header?.openingFloat ?? "";

    $("posTotal").value = data.sales?.posTotal ?? "";
    $("posCard").value = data.sales?.posCard ?? "";
    $("posCash").value = data.sales?.posCash ?? "";
    $("actualCard").value = data.sales?.actualCard ?? "";
    $("actualCashInDrawer").value = data.sales?.actualCashInDrawer ?? "";
    $("cashExpenses").value = data.sales?.cashExpenses ?? "";
    $("actualDeposit").value = data.sales?.actualDeposit ?? "";
    $("diffType").value = data.sales?.diffType || "";
    $("diffReason").value = data.sales?.diffReason || "";

    $("mada").value = data.cardsBreakdown?.mada ?? "";
    $("visa").value = data.cardsBreakdown?.visa ?? "";
    $("master").value = data.cardsBreakdown?.master ?? "";
    $("cardNote").value = data.cardsBreakdown?.note || "";

    $("cashierNotes").value = data.notes?.cashier || "";
    $("supervisorNotes").value = data.notes?.supervisor || "";

    $("cashierAck").value = data.approvals?.cashierAck || "";
    $("supervisorAck").value = data.approvals?.supervisorAck || "";

    // voids
    $("voidBody").innerHTML = "";
    (data.voids||[]).forEach(v=> $("voidBody").appendChild(makeVoidRow(v)));

    // images
    imgs.close = data.attachments?.closeSheetImages || [];
    imgs.span  = data.attachments?.spanReportImages || [];
    imgs.dep   = data.attachments?.depositSlipImages || [];
    renderThumbs(imgs.close, "thumbClose");
    renderThumbs(imgs.span, "thumbSpan");
    renderThumbs(imgs.dep, "thumbDep");
    setTag("tagClose", imgs.close.length>0);
    setTag("tagSpan", imgs.span.length>0);
    setTag("tagDep", imgs.dep.length>0);

    recalc();
  }

  // ===== Save/Load (LocalStorage) =====
  const KEY = "nasaq_daily_closing_last";

  function save(status="DRAFT"){
    recalc();
    const data = pack(status);
    localStorage.setItem(KEY, JSON.stringify(data));
    return data;
  }

  $("btnDraft").onclick = ()=>{
    save("DRAFT");
    const box = $("statusBox");
    box.classList.remove("bad","neu"); box.classList.add("ok");
    $("statusText").textContent = "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©";
    setTimeout(()=> validate(), 800);
  };

  $("btnLoad").onclick = ()=>{
    const raw = localStorage.getItem(KEY);
    if(!raw){ alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­ÙØ¸ Ø³Ø§Ø¨Ù‚."); return; }
    try{
      fill(JSON.parse(raw));
      alert("ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø­ÙØ¸.");
    }catch(e){
      alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹. Ø±Ø¨Ù…Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ù„ÙØ©.");
    }
  };

  $("btnExport").onclick = ()=>{
    const data = save("DRAFT");
    const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    const safeDate = (data.header.date||"").replaceAll("-","");
    a.href = url;
    a.download = `daily-closing_${data.header.brand||"brand"}_${safeDate||"date"}_${data.header.branch||"branch"}.json`;
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=> URL.revokeObjectURL(url), 1500);
  };

  $("btnPrint").onclick = ()=>{
    // print thumbs (optional)
    const p = $("printThumbs");
    p.innerHTML = "";
    [...(imgs.close||[]), ...(imgs.span||[]), ...(imgs.dep||[])].slice(0,8).forEach(x=>{
      const img = document.createElement("img");
      img.src = x.data;
      img.style.width="120px"; img.style.height="120px"; img.style.objectFit="cover";
      img.style.margin="6px"; img.style.border="1px solid #e5e7eb"; img.style.borderRadius="12px";
      p.appendChild(img);
    });
    window.print();
  };

  $("btnClear").onclick = ()=>{
    if(!confirm("ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ØŸ")) return;
    localStorage.removeItem(KEY);
    location.reload();
  };

  $("btnApprove").onclick = ()=>{
    // hard validate
    recalc();
    if($("btnApprove").disabled){
      alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„ÙØ§Ø±Ù‚ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯Ù‡.");
      return;
    }
    const data = save("APPROVED");
    const box = $("statusBox");
    box.classList.remove("bad","neu"); box.classList.add("ok");
    $("statusText").textContent = "âœ… Ù…Ø¹ØªÙ…Ø¯";
    alert("ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ù‹Ø§ ØªØµØ¯ÙŠØ± JSON Ù„Ù„Ø£Ø±Ø´ÙØ©.");
  };

  // Init
  (function init(){
    $("date").value = todayISO();
    // add one void row by default? (no)
    recalc();
    validate();
  })();
</script>
</body>
</html>
